<%
  title = t(".title")
  if @search
    @sub_title = "#{t('.search_results_subtitle')} (#{@size})"
  else
    @sub_title = t(".default_nodes_subtitle")
  end
%>

<header class="mdl-layout__header nodes__header">
  <div class="mdl-layout__header-row">
    <span class="mdl-layout-title mdl-badge" data-badge="Î²">
      <a href="/nodes"><%= title %></a>
    </span>
    <i class="material-icons">chevron_right</i>
    <span class="mdl-layout-title nodes__sub-title"><%= @sub_title %></span>

    <div id="nodes__actions" disabled="disabled">
      <div id="nodes__export-selected">
        <label class="mdl-button mdl-js-button mdl-button--icon">
          <i class="material-icons">content_copy</i>
        </label>
        <textarea class="mdl-shadow--2dp" rows="10"></textarea>
      </div>

      <div id="export-selected__variants">
        <% current_variant = current_user.settings[:export_selected_variant] || Settings.export_selected_variant %>
        <% User.settings[:export_selected_variant][:accepted_values].each do |variant, mapping| %>
          <%= link_to user_path(current_user, export_selected_variant: variant),
            remote: true,
            "data-variant": variant,
            class: (variant == current_variant) ? "disabled-link" : "" do %>
            <div name="<%= variant %>" <% if variant == current_variant %>selected="selected"<% end %>>
              <%= mapping.html_safe %>
            </div>
          <% end %>
        <% end %>
      </div>

      <div class="mdl-tooltip" for="nodes__export-selected">
        <%= t(".export_selected") %>
      </div>


      <div id="nodes__unselect-all" class="mdl-badge">
        <button class="mdl-button mdl-js-button mdl-button--icon">
          <i class="material-icons">close</i>
        </button>
      </div>

      <div class="mdl-tooltip" for="nodes__unselect-all">
        <%= t(".unselect_all") %>
      </div>
    </div>

    <div id="nodes__select-all">
      <button class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">select_all</i>
      </button>
    </div>

    <div class="mdl-tooltip" for="nodes__select-all">
      <%= t(".select_all") %>
    </div>

    <div class="mdl-layout-spacer nodes__search">
      <form action="/nodes" method="get">
        <input name="search" type="text" tabindex="1" autofocus placeholder="<%= t(".quick_search") %>" value="<%= params[:search] %>" />
      </form>
    </div>

    <nav class="mdl-navigation">
      <% if current_user.role == "administrator" %>
        <a class="mdl-navigation__link nodes__navigation-link" href="/settings#general">
          <label class="mdl-button mdl-js-button mdl-button--icon">
            <i class="material-icons">settings</i>
          </label><%= t(".settings") %>
        </a>
      <% end %>
      <% unless Settings.support_email.empty? %>
        <a class="mdl-navigation__link nodes__navigation-link" href="mailto:<%= Settings.support_email %>">
          <label class="mdl-button mdl-js-button mdl-button--icon">
            <i class="material-icons">feedback</i>
          </label><%= t(".support") %>
        </a>
      <% end %>
      <%= link_to edit_user_path(current_user), class: "mdl-navigation__link nodes__navigation-link" do %>
        <label class="mdl-button mdl-js-button mdl-button--icon">
          <i class="material-icons">person</i>
        </label><%= t(".profile") %>
      <% end %>
      <%= link_to sign_out_path, class: "mdl-navigation__link nodes__navigation-link", method: :delete do %>
        <label class="mdl-button mdl-js-button mdl-button--icon">
          <i class="material-icons">exit_to_app</i>
        </label><%= t(".exit") %>
      <% end %>
    </nav>
  </div>
</header>

<% if false %>
<% if @search %>
  <div class="header__back-icon">
    <a href="/nodes">
      <i id="back-button" class="material-icons">arrow_back</i>
    </a>
  </div>
<% end %>
<% end %>
